<style>
    /* Modal chung */
.modal-content {
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    border: none;
}

.modal-header {
    background-color: #f8f9fa;
    border-bottom: 1px solid #e9ecef;
    border-radius: 12px 12px 0 0;
}

.modal-title {
    font-weight: 600;
    color: #333;
}

.modal-body {
    padding: 20px;
}

.modal-footer {
    border-top: 1px solid #e9ecef;
    border-radius: 0 0 12px 12px;
}
/* Nút bấm */
.btn-primary {
    background-color: #007bff;
    border-color: #007bff;
    transition: background-color 0.3s ease, border-color 0.3s ease;
}

.btn-primary:hover {
    background-color: #0056b3;
    border-color: #004085;
}

.btn-outline-primary {
    color: #007bff;
    border-color: #007bff;
    transition: color 0.3s ease, background-color 0.3s ease;
}

.btn-outline-primary:hover {
    color: #fff;
    background-color: #007bff;
    border-color: #007bff;
}
/* Form input */
.form-control {
    border-radius: 8px;
    border: 1px solid #ced4da;
    padding: 10px;
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
}

.form-control:focus {
    border-color: #80bdff;
    box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
}

.form-label {
    font-weight: 500;
    color: #555;
}

.form-check-label {
    color: #555;
}
/* Liên kết và văn bản */
a {
    color: #007bff;
    text-decoration: none;
    transition: color 0.3s ease;
}

a:hover {
    color: #0056b3;
    text-decoration: underline;
}

.text-center {
    text-align: center;
}

.mt-3 {
    margin-top: 1rem;
}
/* Padding và margin */
.d-grid.gap-3 {
    gap: 1rem !important;
}

.mb-3 {
    margin-bottom: 1rem !important;
}

.mt-3 {
    margin-top: 1rem !important;
}
/* Padding và margin */
.d-grid.gap-3 {
    gap: 1rem !important;
}

.mb-3 {
    margin-bottom: 1rem !important;
}

.mt-3 {
    margin-top: 1rem !important;
}

</style>


<!-- Modal chính chứa lựa chọn ban đầu -->
<div class="modal fade" id="authModal" tabindex="-1" aria-labelledby="authModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="authModalLabel">Đăng nhập / Đăng ký</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center">
                <p>Vui lòng chọn một trong các tùy chọn sau:</p>
                <div class="d-grid gap-3">
                    <button class="btn btn-primary" onclick="showLoginForm()">Đã có tài khoản</button>
                    <button class="btn btn-outline-primary" onclick="showRegisterForm()">Chưa có tài khoản</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal đăng nhập -->
<div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="loginModalLabel">Đăng nhập</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="loginForm" method="post" action="/Account/Login">
    <div class="mb-3">
        <label for="loginEmail" class="form-label">Email</label>
        <input type="email" class="form-control" id="loginEmail" name="email" required>
    </div>
    <div class="mb-3">
        <label for="loginPassword" class="form-label">Mật khẩu</label>
        <input type="password" class="form-control" id="loginPassword" name="password" required>
    </div>
    <div class="mb-3 form-check">
        <input type="checkbox" class="form-check-input" id="rememberMe" name="rememberMe">
        <label class="form-check-label" for="rememberMe">Ghi nhớ đăng nhập</label>
    </div>
    <div class="text-center">
        <button type="submit" class="btn btn-primary">Đăng nhập</button>
        <div class="mt-3">
            <a href="#" onclick="showAuthModal()">Quay lại</a>
        </div>
    </div>
</form>

            </div>
        </div>
    </div>
</div>

<!-- Modal đăng ký -->
<div class="modal fade" id="registerModal" tabindex="-1" aria-labelledby="registerModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="registerModalLabel">Đăng ký</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="registerForm" method="post" action="/Account/Register">
                    <div class="mb-3">
                        <label for="registerEmail" class="form-label">Email</label>
                        <input type="email" class="form-control" id="registerEmail" name="email" required>
                        <div class="form-text">Mật khẩu sẽ được gửi đến email của bạn</div>
                    </div>
                   
                    <div class="text-center">
                        <button type="submit" class="btn btn-primary">Đăng ký</button>
                        <div class="mt-3">
                            <a href="#" onclick="showAuthModal()">Quay lại</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript để điều khiển modal -->
<script>
    function openAuthModal() {
        var authModal = new bootstrap.Modal(document.getElementById('authModal'));
        authModal.show();
    }

    function showLoginForm() {
        var authModal = bootstrap.Modal.getInstance(document.getElementById('authModal'));
        authModal.hide();
        setTimeout(function() {
            var loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
            loginModal.show();
        }, 400);
    }

    function showRegisterForm() {
        var authModal = bootstrap.Modal.getInstance(document.getElementById('authModal'));
        authModal.hide();
        setTimeout(function() {
            var registerModal = new bootstrap.Modal(document.getElementById('registerModal'));
            registerModal.show();
        }, 400);
    }

    function showAuthModal() {
        var currentModal = bootstrap.Modal.getInstance(document.getElementById('loginModal')) 
            || bootstrap.Modal.getInstance(document.getElementById('registerModal'));
        
        if (currentModal) {
            currentModal.hide();
        }
        
        setTimeout(function() {
            var authModal = new bootstrap.Modal(document.getElementById('authModal'));
            authModal.show();
        }, 400);
    }

  document.getElementById('loginForm').addEventListener('submit', function (e) {
    e.preventDefault();

    // Lấy giá trị từ form
    var email = document.getElementById('loginEmail').value.trim();
    var password = document.getElementById('loginPassword').value.trim();
    var rememberMe = document.getElementById('rememberMe').checked;

    // Kiểm tra dữ liệu đầu vào
    if (!email || !password) {
        alert("Vui lòng nhập đầy đủ email và mật khẩu!");
        return;
    }

    // Tạo FormData và thêm dữ liệu
    var formData = new FormData();
    formData.append('Email', email);
    formData.append('Password', password);
    formData.append('RememberMe', rememberMe);

    // Gửi yêu cầu POST đến controller
    fetch('/Account/Login', {
        method: 'POST',
        body: formData
    })
    .then(response => {
        if (response.redirected) {
            // Nếu có chuyển hướng, điều hướng đến trang chính
            window.location.href = response.url;
        } else {
            // Nếu không có chuyển hướng, hiển thị thông báo lỗi
            return response.text().then(text => {
                alert(text || "Đăng nhập thất bại! Vui lòng kiểm tra lại.");
            });
        }
    })
    .catch(error => {
        console.error('Lỗi đăng nhập:', error);
        alert("Đã xảy ra lỗi khi đăng nhập. Vui lòng thử lại!");
    });
});



    // Xử lý form đăng ký
 document.getElementById('registerForm').addEventListener('submit', function (e) {
    e.preventDefault();

    var formData = new FormData(this); // Lấy dữ liệu từ form

    fetch('/Account/Register', {
        method: 'POST',
        body: formData // Gửi FormData thay vì JSON.stringify
    })
    .then(response => response.text()) // Nhận HTML hoặc redirect
    .then(data => {
        alert('Đăng ký thành công! Vui lòng kiểm tra email để nhận mật khẩu');
        window.location.href = "/Account/Login"; // Chuyển hướng đến trang đăng nhập
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Đã xảy ra lỗi khi đăng ký. Vui lòng thử lại.');
    });
});



</script>